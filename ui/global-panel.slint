import { Panel, VerticalSpacer, SectionLabel, CenteredParameterSlider, PanelLabel, HorizontalSpacer, ComponentLabel, MixerLevel, MixerBalance,
MixerMute, VerticalIntSlider,
ToggleSwitch, HorizontalParameterSlider, IntSpinBox, EnvelopeSection, FixedCenterLFOSection } from "components.slint";
import { Theme } from "theme.slint";
import { Constant } from "constants.slint";
import { VerticalSlider, HorzontalSlider, BalanceSlider } from "custom-widgets.slint";
import { ComboBox, TextEdit } from "std-widgets.slint";

export component MixerStrip inherits VerticalLayout {
    in-out property <string> label;
    in property <float> default-value: 0.0;
    callback mixer-level-update(float);
    callback mixer-balance-update(float);
    callback mixer_mute_update(bool);

    SectionLabel {
        label: label;
    }

    HorizontalSpacer { }

    VerticalLayout {
        padding: Theme.global-panel-padding;
        spacing: Theme.global-panel-spacing;
        alignment: space-between;

        MixerBalance {
            mixer-balance-update(value) => {
                root.mixer-balance-update(value);
            }
        }

        MixerLevel {
            default-value: default-value;
            slider-height: 100px;

            mixer-level-update(value) => {
                root.mixer-level-update(value);
            }
        }

        MixerMute {
            mixer_mute_update(is_muted) => {
                root.mixer_mute_update(is_muted);
            }
        }
    }
}

export component OutputMixer inherits VerticalLayout {
    in property <float> level-minimum: Constant.SILENCE_LEVEL_DBFS;
    in property <float> level-maximum: Constant.MAX_OUTPUT_LEVEL_DBFS;
    in property <float> default-level: Constant.DEFAULT_OUTPUT_LEVEL_DBFS;

    callback output-level-update(float);
    callback output-balance-update(float);

    output := MixerStrip {
        label: Theme.output-mixer-label;
        default-value: default-level;
    }
}

export component OscillatorMixer inherits VerticalLayout {
    in property <float> level-minimum: Constant.SILENCE_LEVEL_DBFS;
    in property <float> level-maximum: Constant.MAX_OUTPUT_LEVEL_DBFS;

    HorizontalLayout {
        MixerStrip {
            label: Theme.osc-mixer-title-1;
            default-value: level-maximum;
        }

        VerticalSpacer { }

        MixerStrip {
            label: Theme.osc-mixer-title-2;
            default-value: level-maximum;
        }

        VerticalSpacer { }

        MixerStrip {
            label: Theme.osc-mixer-title-3;
            default-value: level-maximum;
        }

        VerticalSpacer { }

        MixerStrip {
            label: Theme.osc-mixer-title-sub;
            default-value: level-minimum;
        }

        VerticalSpacer { }
    }
}

export component MixerSection inherits VerticalLayout {
    alignment: start;
    padding-top: Theme.global-panel-padding;

    PanelLabel {
        label: Theme.osc-mixer-label;
    }

    VerticalLayout {
        alignment: start;

        HorizontalLayout {

            VerticalSpacer { }

            outout-mixer := OutputMixer {
                output-level-update(value) => {
                }
            }

            VerticalSpacer { }

            oscillator-mixer := OscillatorMixer { }
        }
    }
}

export component OscillatorSection inherits VerticalLayout {
    alignment: start;

    HorizontalLayout {
        alignment: start;
        HorizontalLayout {
            padding: Theme.global-panel-padding;
            spacing: Theme.global-panel-spacing;
            alignment: start;

            portamento-section := VerticalLayout {
                padding: Theme.global-panel-padding;
                spacing: Theme.global-panel-spacing;
                alignment: space-between;

                ToggleSwitch {
                    label: Theme.osc-options-portamento-label;
                }

                HorizontalParameterSlider {
                    label: Theme.osc-options-portamento-time-label;
                    value-units: Theme.osc-options-portamento-time-postfix;
                    default-value: 0;
                }
            }

            VerticalSpacer { }

            HorizontalLayout {
                padding: Theme.global-panel-padding;
                spacing: Theme.global-panel-spacing;
                alignment: space-between;

                VerticalLayout {
                    alignment: space-between;

                    IntSpinBox {
                        label: Theme.osc-options-pitch-bend-range;
                        default-value: 12;
                        step: 1;
                        width: 120px;
                    }

                    CenteredParameterSlider {
                        label: Theme.osc-options-velocity-curve;
                        value: 0;
                        width: 120px;
                    }
                }

                VerticalSpacer { }

                VerticalLayout {
                    alignment: space-between;

                    ToggleSwitch {
                        label: Theme.osc-options-hard-sync;
                    }

                    ToggleSwitch {
                        label: Theme.osc-options-key-sync;
                    }
                }

                VerticalSpacer { }
            }
        }
    }
}

export component AmpEnvelopeSection inherits VerticalLayout {
    alignment: start;
    padding-top: Theme.global-panel-padding;

    PanelLabel {
        label: Theme.amp-envelope-section-label;
    }

    EnvelopeSection { }
}

export component ModWheelSection inherits VerticalLayout {
    alignment: start;
    padding-top: Theme.global-panel-padding;

    PanelLabel {
        label: Theme.mod-wheel-section-label;
    }

    HorizontalLayout {
        alignment: start;
        VerticalSpacer { }

        FixedCenterLFOSection { }
    }
}

export component GlobalPanel inherits Panel {
    height: Theme.global-panel-height;

    HorizontalLayout {
        alignment: start;

        mixer-section := MixerSection { }

        VerticalLayout {
            alignment: start;
            HorizontalLayout {
                alignment: start;
                amp-section := AmpEnvelopeSection { }

                mod-whee-section := ModWheelSection { }
            }

            HorizontalSpacer { }

            osc-section := OscillatorSection { }
        }
    }
}
